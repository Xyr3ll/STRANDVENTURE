@model STRANDVENTURE.Models.TeacherForgotPasswordViewModel
@{
    ViewData["Title"] = "Teacher Password Reset";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - STRANDVENTURE</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/login-styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/icons.css" asp-append-version="true" />
</head>
<body class="teacher-login-body">
    <div class="login-container">
        <div class="login-card teacher-theme">
            <div class="login-header">
                <i class="fas fa-key login-icon"></i>
                <h2>Reset Password</h2>
                <p class="login-subtitle">Verify your identity to reset your password</p>
            </div>

            <form method="post" class="login-form" id="teacherForgotPwdForm">
                @Html.AntiForgeryToken()

                @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                {
                    <div class="alert alert-danger" role="alert">
                        <i class="fas fa-exclamation-triangle"></i>
                        @Model.ErrorMessage
                    </div>
                }

                @if (!string.IsNullOrEmpty(Model.SuccessMessage))
                {
                    <div class="alert alert-success" role="alert">
                        <i class="fas fa-check-circle"></i>
                        @Model.SuccessMessage
                    </div>
                }

                <div class="form-group">
                    <label asp-for="Input.Email" class="form-label">
                        <i class="fas fa-envelope"></i>
                        Email Address
                    </label>
                    <input asp-for="Input.Email" class="form-control" placeholder="Enter your account email" />
                    <span asp-validation-for="Input.Email" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Input.NewPassword" class="form-label">
                        <i class="fas fa-lock"></i>
                        New Password
                    </label>
                    <div class="password-input-group">
                        <input asp-for="Input.NewPassword" class="form-control" placeholder="Enter a new password" />
                        <button type="button" class="password-toggle" onclick="togglePassword('Input_NewPassword')">
                            <i class="fas fa-eye" id="Input_NewPassword_icon"></i>
                        </button>
                    </div>
                    <span asp-validation-for="Input.NewPassword" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Input.ConfirmPassword" class="form-label">
                        <i class="fas fa-check-double"></i>
                        Confirm Password
                    </label>
                    <div class="password-input-group">
                        <input asp-for="Input.ConfirmPassword" class="form-control" placeholder="Re-enter your new password" />
                        <button type="button" class="password-toggle" onclick="togglePassword('Input_ConfirmPassword')">
                            <i class="fas fa-eye" id="Input_ConfirmPassword_icon"></i>
                        </button>
                    </div>
                    <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Input.CaptchaInput" class="form-label">
                        <i class="fas fa-shield-alt"></i>
                        Security Verification
                    </label>
                    <div class="captcha-container">
                        <div class="captcha-image-container">
                            <img id="captchaImage" src="data:image/svg+xml;base64,@Model.CaptchaImageBase64" alt="CAPTCHA" />
                            <button type="button" class="captcha-refresh" onclick="refreshCaptcha()" title="Refresh CAPTCHA">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <input asp-for="Input.CaptchaInput" class="form-control" placeholder="Enter CAPTCHA code" maxlength="5" />
                    </div>
                    <span asp-validation-for="Input.CaptchaInput" class="text-danger"></span>
                </div>

                <button type="submit" class="btn btn-login teacher-btn" id="resetBtn">
                    <span class="login-text">
                        <i class="fas fa-key"></i>
                        Reset Password
                    </span>
                    <span class="loading-spinner" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                        Processing...
                    </span>
                </button>

                <div class="login-links">
                    <a href="/Home/TeacherLogin" class="switch-portal-link">
                        <i class="fas fa-arrow-left"></i>
                        Back to Login
                    </a>
                </div>
            </form>
        </div>

        <div class="login-footer">
            <p>&copy; 2025 STRANDVENTURE - Student Management System</p>
        </div>
    </div>

    <!-- Toast container for success redirect notification -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080;">
        <div id="resetToast" class="toast bg-success text-white border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-check-circle text-success me-2"></i>
                <strong class="me-auto">Password Reset</strong>
                <small class="text-muted">Auto redirect</small>
                <button type="button" class="btn-close ms-2 mb-1" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="resetToastBody">
                @Model.SuccessMessage
            </div>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/js/login-script.js" asp-append-version="true"></script>

    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
    {
        <script>
            (function () {
                var toastEl = document.getElementById('resetToast');
                var bodyEl = document.getElementById('resetToastBody');
                var countdown = 5;
                var baseMsg = (bodyEl && bodyEl.textContent.trim()) ? bodyEl.textContent.trim() : 'Password reset successful.';

                function updateBody() {
                    if (!bodyEl) return;
                    bodyEl.textContent = baseMsg + ' Redirecting to login in ' + countdown + ' second' + (countdown === 1 ? '' : 's') + '...';
                }

                // Try Bootstrap 5 API first
                if (window.bootstrap && bootstrap.Toast) {
                    var toast = new bootstrap.Toast(toastEl);
                    updateBody();
                    toast.show();
                } else if (window.jQuery && typeof jQuery.fn.toast === 'function') {
                    // Fallback for Bootstrap 4 jQuery plugin
                    updateBody();
                    jQuery(toastEl).toast({ autohide: false }).toast('show');
                } else {
                    // If no toast API is available, do nothing visual
                }

                var intervalId = setInterval(function () {
                    countdown--;
                    if (countdown > 0) {
                        updateBody();
                    }
                }, 1000);

                setTimeout(function () {
                    clearInterval(intervalId);
                    window.location.href = '/Home/TeacherLogin';
                }, 5000);
            })();
        </script>
    }
</body>
</html>
