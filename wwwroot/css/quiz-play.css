/* Gamified Play Styling (Dark Theme) */
.quiz-stage {display:grid; gap:1.4rem;}
.hud {display:flex; flex-wrap:wrap; gap:1rem; align-items:center; font-size:.8rem; letter-spacing:.5px;}
.hud-block {background:#0d2537; color:#d2e9f7; padding:.65rem .9rem; border-radius:10px; border:1px solid #13374d; position:relative; overflow:hidden;}
.hud-block:before {content:""; position:absolute; inset:0; background:linear-gradient(120deg,transparent,rgba(255,255,255,.06),transparent); transform:translateX(-100%); animation:shimmer 7s linear infinite;}
@keyframes shimmer {0%{transform:translateX(-100%);} 80%,100%{transform:translateX(140%);} }
.progress-shell {height:12px; background:#0c2231; border-radius:6px; overflow:hidden; box-shadow:0 0 0 1px #0d334d inset; position:relative; flex:1;}
.progress-shell span {display:block; height:100%; background:linear-gradient(90deg,#19c1b6,#1e88e5); width:0; animation:grow 600ms ease forwards;}
@keyframes grow {from{width:0;} to{width:var(--w);} }
.streak-glow {animation:streakPulse 1.8s ease-in-out infinite;}
@keyframes streakPulse {0%,100%{box-shadow:0 0 0 rgba(25,193,182,0);} 50%{box-shadow:0 0 14px -2px rgba(25,193,182,.55);} }
.anim-toast {position:fixed; top:20px; left:50%; transform:translateX(-50%); background:#0b2036; color:#fff; padding:.7rem 1rem; border-radius:12px; font-size:.75rem; letter-spacing:.5px; display:flex; gap:.55rem; align-items:center; box-shadow:0 4px 18px -4px #000c; animation:fadeSlide .45s ease; z-index:1100;}
@keyframes fadeSlide { from {opacity:0; transform:translate(-50%, -10px);} to {opacity:1; transform:translate(-50%,0);} }
/* Dismiss animation */
.anim-toast.toast-hide {animation:toastDismiss .4s ease forwards;}
@keyframes toastDismiss {0%{opacity:1; transform:translate(-50%,0) scale(1);} 100%{opacity:0; transform:translate(-50%,-14px) scale(.92);} }
.shield-pulse { animation:shieldPulse 1.2s ease-in-out 2; }
@keyframes shieldPulse { 0% { transform:scale(1); } 50% { transform:scale(1.18); } 100% { transform:scale(1);} }
.correct-flash { animation:correctFlash .9s ease; }
@keyframes correctFlash {0%{background:#0d4722; color:#fff;} 40%{background:#16a34a;} 100%{background:transparent;} }
.shield-gain-burst {position:fixed; inset:0; pointer-events:none; overflow:hidden;}
.shield-gain-burst span {position:absolute; font-size:1.2rem; animation:rise 1.4s ease forwards; opacity:0.85;}
@keyframes rise {0%{transform:translateY(20px) scale(.6); opacity:0;} 30%{opacity:1;} 100%{transform:translateY(-160px) scale(1.1); opacity:0;}}
.answer-grid {display:grid; gap:.75rem;}
.quiz-answer-form button {position:relative; background:#0d2537; border:1px solid #13374d; color:#d2e9f7; font-weight:500; letter-spacing:.2px; padding:.85rem 1rem; border-radius:14px; transition:background .22s, transform .15s, border-color .22s, box-shadow .22s; text-align:left; width:100%; overflow:hidden;}
.quiz-answer-form button:hover {background:#12324a; transform:translateY(-2px); border-color:#1d4863; box-shadow:0 4px 14px -6px rgba(0,0,0,.4);}
.quiz-answer-form button:active {transform:translateY(0);}
.quiz-answer-form button:focus-visible {outline:2px solid #19c1b6; outline-offset:2px;}
.kbd {background:#12324a; padding:2px 6px; border-radius:6px; font-size:.65rem; margin-left:.45rem; color:#7dd9ff;}
.finish-btn {background:#071d2a; border:1px solid #153e54; color:#9ecfe6;}
.finish-btn:hover {background:#0f3244; color:#fff;}
.card.game-card {border:1px solid #16364b; background:linear-gradient(145deg,#092131,#04131d); border-radius:22px; box-shadow:0 10px 26px -10px #000f; color:#d2e9f7;}
.card.game-card h5 {font-weight:600; letter-spacing:.4px; color:#ffffff;}
.question-index {font-size:.7rem; text-transform:uppercase; letter-spacing:1.4px; color:#6abed4; font-weight:600;}
.shield-icon {color:#19c1b6;}
.toast-icon {font-size:.9rem; line-height:1;}
.quiz-hero.play-hero {padding:1.8rem 1.6rem;}
.quiz-hero.play-hero h2 {color:#fff;}
.quiz-hero.play-hero p, .quiz-hero.play-hero .hud-block, .quiz-hero.play-hero .card.game-card {color:#d2e9f7;}
/* BGM Control */
.bgm-control {position:fixed; bottom:18px; right:18px; background:#0b2036; border:1px solid #123447; border-radius:16px; padding:.6rem .85rem; display:flex; align-items:center; gap:.65rem; box-shadow:0 4px 18px -4px #000c; z-index:1200; font-size:.7rem; color:#d2e9f7;}
.bgm-control button {background:#12324a; border:1px solid #1c4d66; color:#d2e9f7; width:32px; height:32px; display:inline-flex; align-items:center; justify-content:center; border-radius:10px; cursor:pointer; transition:background .2s,border-color .2s, transform .15s;}
.bgm-control button:hover {background:#184864; border-color:#24617f;}
.bgm-control button:active {transform:scale(.92);} 
.bgm-control input[type=range] {width:110px; accent-color:#19c1b6; height:4px; cursor:pointer;}
.bgm-control .label {text-transform:uppercase; letter-spacing:1px; opacity:.7; font-size:.55rem;}
@media (max-width:600px){ .bgm-control {bottom:12px; right:12px; padding:.55rem .7rem;} .bgm-control input[type=range]{width:90px;} }
@media (prefers-reduced-motion: reduce){ .bgm-control button {transition:none;} }
@media (prefers-reduced-motion: reduce) { .hud-block:before, .streak-glow, .shield-pulse, .quiz-answer-form button:hover, .anim-toast {animation:none;} }

/* --- Added Enhanced Animations --- */
/* Card entrance animation each question */
.card.game-card { animation:cardIn .55s cubic-bezier(.4,.8,.3,1) both; }
@keyframes cardIn {0%{opacity:0; transform:translateY(14px) scale(.97);}60%{opacity:1;}100%{opacity:1; transform:translateY(0) scale(1);} }
/* Ambient subtle gradient drift for hero */
.quiz-hero.play-hero { background:radial-gradient(circle at 30% 30%, #12395f, #071726 70%); animation:heroGlow 8s ease-in-out infinite; background-size:140% 140%; }
@keyframes heroGlow {0%,100%{background-position:30% 30%;}50%{background-position:70% 60%;} }
/* Ripple effect on answer buttons */
.quiz-answer-form button .ripple {position:absolute; width:220px; height:220px; margin:-110px 0 0 -110px; left:var(--x); top:var(--y); background:radial-gradient(circle at center, rgba(25,193,182,.45), rgba(25,193,182,0) 70%); pointer-events:none; border-radius:50%; transform:scale(.2); opacity:.85; animation:ripple .7s ease-out forwards; mix-blend-mode:screen;}
@keyframes ripple {to{transform:scale(1); opacity:0;}}
/* Correct state border pulse */
.answer-grid.correct-state .quiz-answer-form button { border-color:#16a34a !important; animation:correctBtnPulse .9s ease; }
@keyframes correctBtnPulse {0%{box-shadow:0 0 0 0 #16a34a; background:#0d4722;}60%{box-shadow:0 0 0 4px rgba(22,163,74,.18);}100%{box-shadow:0 0 0 0 rgba(22,163,74,0);} }
/* Fade-out easing for correct state removal */
.answer-grid.correct-fading .quiz-answer-form button { animation:correctBtnFade .6s ease forwards; }
@keyframes correctBtnFade {0%{border-color:#16a34a; box-shadow:0 0 0 2px rgba(22,163,74,.25); background:rgba(13,71,34,.28);}100%{border-color:#13374d; box-shadow:0 0 0 0 rgba(22,163,74,0); background:#0d2537;} }
/* Incorrect active state styling + pulse */
.answer-grid.incorrect-state .quiz-answer-form button { border-color:#dc2626 !important; animation:incorrectBtnPulse .9s ease; }
@keyframes incorrectBtnPulse {0%{box-shadow:0 0 0 0 #dc2626; background:#3b1014;}60%{box-shadow:0 0 0 4px rgba(220,38,38,.15);}100%{box-shadow:0 0 0 0 rgba(220,38,38,0);} }
/* Incorrect fade-out easing */
.answer-grid.incorrect-fading .quiz-answer-form button { animation:incorrectBtnFade .6s ease forwards; }
@keyframes incorrectBtnFade {0%{border-color:#dc2626; box-shadow:0 0 0 2px rgba(220,38,38,.25); background:rgba(91,17,24,.32);}100%{border-color:#13374d; box-shadow:0 0 0 0 rgba(220,38,38,0); background:#0d2537;} }
/* Card specific incorrect flash (separate from correctFlash) */
.card.game-card.incorrect-flash { animation:incorrectCardFlash .9s ease, incorrectShake .35s ease-in-out; }
@keyframes incorrectCardFlash {0%{background:#3b1014;}40%{background:#5b1118;}100%{background:linear-gradient(145deg,#092131,#04131d);} }
@keyframes incorrectShake {20%{transform:translateX(-4px);}40%{transform:translateX(4px);}60%{transform:translateX(-3px);}80%{transform:translateX(3px);}100%{transform:translateX(0);} }
/* Floating shields on milestone (applied via JS to #shieldStat.shield-pulse) */
#shieldStat.shield-pulse { animation:shieldPulse 1.2s ease-in-out 2, shieldHover 5s ease-in-out 2.4s infinite; }
@keyframes shieldHover {0%,100%{transform:translateY(0);}50%{transform:translateY(-4px);} }
/* Streak glow intensifies at high streak counts (>=10 add class externally if desired) */
.streak-glow.high-streak { animation:streakPulse 1.2s ease-in-out infinite; box-shadow:0 0 0 1px #19c1b6 inset; }
/* Reduced motion overrides for new animations */
@media (prefers-reduced-motion: reduce){
  .card.game-card, .quiz-hero.play-hero, .quiz-answer-form button .ripple, #shieldStat.shield-pulse, .answer-grid.correct-fading .quiz-answer-form button, .answer-grid.incorrect-fading .quiz-answer-form button {animation:none !important;}
}
